<div class="breadcrumbs">
<%= link_to "Shipment", shipments_path %> > <%= @shipment.shipment_id %>
</div>
<table width="100%">
  <tr>
    <th>&nbsp;</th>
    <td>&nbsp;</td>
  </tr>
  <tr width="50%">
    <td valign="top">
      <table class="table_detail" cellspacing="20" width="100%">
        <tr>
          <th>HAWB</th>
          <th>MAWB</th>
          <th>Service Level</th>
        </tr>
        <tr>
          <td valign="top"><%= @shipment.hawb %></td>
          <td valign="top"><%= @shipment.mawb %></td>
          <td valign="top"><%= @shipment.service_level %></td>
        </tr>
      </table>
    </td>
    <td width="50%" valign="top">
      <table class="table_detail2" width="100%">
        <tr>
          <th>Weight</th>
          <th>Pieces</th>
          <th>Expected Delivery Date</th>
        </tr>
        <tr>
          <td valign="top"><%= @shipment.weight %></td>
          <td valign="top"><%= @shipment.pieces %></td>
          <td valign="top"><%= @shipment.delivery.to_date rescue nil %></td>
        </tr>
      </table>
    </td>
  </tr>
  <tr>
    <th>&nbsp;</th>
    <td>&nbsp;</td>
  </tr>
  <tr class="ships_info">
    <td>
      <div class="sub-header" style="margin-right:6px;">Ship From</div>
      <h3><%= @shipment.shipper %></h3>
      <%= @shipment.origin %>
    </td>
    <td>
      <div class="sub-header" style="margin-left:6px;">Ship To</div>
      <h3><%= @shipment.consignee %></h3>
      <%= @shipment.destination %>
    </td>
  </tr>
  <tr>
    <th>&nbsp;</th>
    <td>&nbsp;</td>
  </tr>
</table>

<div class="header-container">
  <h3 class="table_header_h3"><strong>Milestones</strong></h3>
<%= link_to "Create New Milestone", new_shipment_milestone_path(@shipment), :class => 'popup btn btn-inverse' if can?(:update, Shipment) && can?(:create, Milestone) %>
<br />
<br />
<table class="table_w bordered-table tablesorter" id="milestones_table">
  <thead><tr>
    <th> Update Date & Time </th>
    <th> Updated By </th>
    <th> Status </th>
    <th> Location </th>
    <th> Damage </th>
    <th> Documents </th>
    <th> Note </th>
  </tr></thead>
  <% @shipment.milestones.order("updated_at DESC").each do |ms| %>
    <tr>
      <td> <%= ms.updated_at %> </td>
      <td> <strong><%= ms.driver.try(:email) %></strong> </td>
      <td> <%= ms.action.try(:to_s).try(:humanize) %> </td>
      <td> <%= ms.location %></td>
      <td> <%= ms.damage_desc %> </td>
      <td> <%= ms.doc %> </td>
      <td valign="middle"> <%= check_box_tag :public %> Public </td>
    </tr>  
  <% end %>
</table>

<script type="text/javascript">
  function notifyCreate(data){     
    var response = JSON.parse(data);
    $("#milestone_table_template").tmpl(response).appendTo("#milestones_table");
  }

  function notifyError(data) {
    alert(data);
  }
</script>

<script id="milestone_table_template" type="text/x-jquery-tmpl">
<tr>
  <td> ${created_at} </td>
  <td> ${driver} </td>
  <td> ${action} </td>
  <td> ${location} </td>
  <td> ${damage_desc} </td>
  <td> ${doc} </td>
  <td valign="middle"> <input id="public" name="public" type="checkbox" value="${public}"> Public </td>
</tr>
</script>